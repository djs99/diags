input {
  file {
    path => ["/opt/stack/logs/screen/test.log"]
    tags => ["test"]
    type => "test"
  }
  file {
    path => ["/var/log/cinder/cinder-volume.log"]
    tags => ["cinder"]
    type => "cinder"
  }
  file {
    path => ["/var/log/nova/nova-compute.log"]
    tags => ["nova"]
    type => "nova"
  }
}

filter {
  if "Error encountered during initialization of driver:" in [message] {
        mutate {
          add_field => {
            "possible_cause" => "Driver may not have initialized on Cinder volume"
            "name" => "initialization"
          }
        }
  }
  else if "Either, the 3PAR WS is not running or the version of the WS is invalid" in [message]  {
        mutate {
          add_field => {
            "possible_cause" => "Driver may not have initialized on Cinder volume"
            "name" => "WS"
          }
        }
  }
  else if "Forbidden (HTTP 403) 5 - invalid username or password" in [message]  {
        mutate {
          add_field => {
            "possible_cause" => "Incorrect 3par credentials in the cinder.conf file"
            "name" => "credentials"
          }
        }
  }
  else if "Invalid input received: CPG" in [message]  {
        mutate {
          add_field => {
            "possible_cause" => "The CPG specified in the cinder.conf file does not exist"
            "name" => "CPG"
          }
        }
  }
  else { drop { } }


  mutate {
    gsub => [
      # remove disallowed dimension characters
      "message", "[~/,()]", "",

      # replace spaces with underscores
      "message", " ", "_",
      "possible_cause", " ", "_"
    ]
  }

}
output {
  stdout { codec => rubydebug }

  file {
    path => "../monasca-logs/3par1.txt"
    codec => json_lines
  }
  file {
    path => "../monasca-logs/3par2.txt"
    codec => json_lines
  }
}
